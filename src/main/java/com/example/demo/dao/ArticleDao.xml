<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.ArticleDao">
	<select id="getArticles" resultType="Article">
		select article.*, `member`.nickname, `board`.boardName from article 
		left join `member` on 
		article.uid = `member`.uid
		left join board on
		article.boardCode = board.boardCode
		where 1
		<if test="boardCode != 0">
			and article.boardCode = #{boardCode}
		</if>
		<if test="searchKeyword != null">
			<choose>
				<when test="searchType == 'title'">
					and title like concat('%' , #{searchKeyword}, '%')
				</when>
				<when test="searchType == 'nickname'">
					and nickname like concat('%' , #{searchKeyword}, '%')
				</when>
				<otherwise>
					and (title like concat('%' , #{searchKeyword}, '%')
					or body like concat('%' , #{searchKeyword}, '%'))
				</otherwise>
			</choose>
		</if>
		<if test="uid != 0">
			and article.uid = #{uid}
		</if>
		and articleType = #{articleType}
		order by aid desc
		limit #{page}, #{pageCnt}
	</select>
	
	<select id="getArticlesForMypage" resultType="Article">
		select article.*, `member`.nickname, `board`.boardName from article 
		left join `member` on 
		article.uid = `member`.uid
		left join board on
		article.boardCode = board.boardCode
		where 1
		and articleType = #{articleType}
		and article.uid = #{uid}
	</select>
	
	<select id="getArticle" resultType="Article">
		select article.*, `member`.nickname, `board`.boardName from article 
		left join `member` on 
		article.uid = `member`.uid
		left join board on
		article.boardCode = board.boardCode
		where aid = #{aid}
	</select>
	
	<select id="getArticlesCnt" resultType="int">
		select count(*) from article
		left join `member` on 
		article.uid = `member`.uid
		where 1
		<if test="boardCode != 0">
			and boardCode = #{boardCode}
		</if>
		<if test="searchKeyword != null">
			<choose>
				<when test="searchType == 'title'">
					and title like concat('%' , #{searchKeyword}, '%')
				</when>
				<when test="searchType == 'nickname'">
					and nickname like concat('%' , #{searchKeyword}, '%')
				</when>
				<otherwise>
					and (title like concat('%' , #{searchKeyword}, '%')
					or body like concat('%' , #{searchKeyword}, '%'))
				</otherwise>
			</choose>
		</if>
		and articleType = #{articleType}
	</select>
	
	<select id="getAllArticlesCnt" resultType="int">
		select count(*) from article where articleType = #{articleType}
	</select>
	
	<select id="getArticlesCntForMypage" resultType="int">
		select count(*) from article where articleType = #{articleType} and uid = #{uid}
	</select>
	
	<insert id="add" useGeneratedKeys="true" keyProperty="aid">
		insert into article set title = #{title}, body = #{body}, uid = #{uid}, boardCode = #{boardCode}, articleType = #{articleType}
	</insert>
	
	<update id="update">
		update article set title = #{title}, body = #{body}, boardCode = #{boardCode} where aid = #{aid}
	</update>
	
	<update id="delete">
		update article set delStatus = 1, delDate = now() where aid = #{aid};
	</update>
	
	<update id="hit">
		update article set hit = hit + 1 where aid = #{aid}
	</update>
</mapper>